<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Samir OS - Secure Access</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@0.263.1"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Syne:wght@400;700;800&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        aether: { bg: '#F5F5F7', glass: 'rgba(255, 255, 255, 0.75)', dark: '#1D1D1F', muted: '#86868B', accent: '#FF4F00', secondary: '#0066CC', sand: '#E8E0D5', leaf: '#95C623' }
                    },
                    fontFamily: { sans: ['Inter', 'sans-serif'], display: ['Syne', 'sans-serif'] },
                    animation: { 'soft-rise': 'softRise 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards', 'float': 'float 6s ease-in-out infinite' },
                    keyframes: { 
                        softRise: { from: { opacity: 0, transform: 'translateY(20px)' }, to: { opacity: 1, transform: 'translateY(0)' } },
                        float: { '0%, 100%': { transform: 'translateY(0)' }, '50%': { transform: 'translateY(-10px)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #F5F5F7; color: #1D1D1F; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        
        /* --- PARTICLES --- */
        .falling-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; overflow: hidden; }
        .petal { position: absolute; top: -10%; width: 15px; height: 15px; background: #E8E0D5; border-radius: 100% 0 100% 0; animation: fall linear infinite; opacity: 0.6; }
        .leaf-particle { position: absolute; top: -10%; width: 12px; height: 20px; background: #95C623; border-radius: 0 50% 0 50%; animation: fall linear infinite; opacity: 0.5; }
        @keyframes fall { 0% { transform: translate(0, 0) rotate(0deg); opacity: 0; } 10% { opacity: 0.8; } 100% { transform: translate(100px, 110vh) rotate(720deg); opacity: 0; } }
        .p1 { left: 10%; animation-duration: 10s; } .p2 { left: 20%; animation-duration: 14s; delay: 2s; background: #F2EBE0; } .p3 { left: 35%; animation-duration: 12s; delay: 4s; }
        .p4 { left: 65%; animation-duration: 13s; delay: 3s; background: #F8F4ED; } .p5 { left: 90%; animation-duration: 11s; }
        .l1 { left: 15%; animation-duration: 15s; delay: 1s; } .l2 { left: 75%; animation-duration: 19s; delay: 2s; }

        /* --- UI ELEMENTS --- */
        .aerogel-card { background: rgba(255,255,255,0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border: 1px solid rgba(255,255,255,0.8); box-shadow: 0 20px 40px -10px rgba(0,0,0,0.1); border-radius: 24px; }
        .input-modern { width: 100%; background: #F5F5F7; padding: 16px 16px 16px 48px; border-radius: 16px; border: 1px solid transparent; outline: none; font-weight: 600; transition: all 0.3s; }
        .input-modern:focus { background: white; border-color: #FF4F00; box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
        .btn-glass { background: #1D1D1F; color: white; font-weight: 700; border-radius: 16px; transition: all 0.3s; box-shadow: 0 10px 20px rgba(0,0,0,0.1); }
        .btn-glass:hover { transform: translateY(-2px); box-shadow: 0 15px 30px rgba(0,0,0,0.2); background: #FF4F00; }
        .btn-glass:active { transform: scale(0.98); }
        
        .custom-scrollbar::-webkit-scrollbar { width: 0px; background: transparent; }
        .safe-pb { padding-bottom: env(safe-area-inset-bottom); }
    </style>
</head>
<body>
    <div class="falling-container">
        <div class="petal p1"></div><div class="petal p2"></div><div class="petal p3"></div><div class="petal p4"></div><div class="petal p5"></div>
        <div class="leaf-particle l1"></div><div class="leaf-particle l2"></div>
    </div>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, memo } = React;

        // --- ICONS ---
        const Icon = memo(({ name, size = 24, className = "" }) => {
            if (!window.lucide?.icons) return null;
            const iconName = name.split('-').map(p => p.charAt(0).toUpperCase() + p.slice(1)).join('');
            if (!window.lucide.icons[iconName]) return null;
            const svg = window.lucide.icons[iconName].toSvg({ width: size, height: size, class: className });
            return <span dangerouslySetInnerHTML={{ __html: svg }} className="inline-flex items-center justify-center" />;
        });

        // --- 1. AUTH PORTAL (Login / Sign Up) ---
        const AuthPortal = ({ onAuthenticate }) => {
            const [isLogin, setIsLogin] = useState(true); // Toggle between Login and Signup
            const [username, setUsername] = useState("");
            const [password, setPassword] = useState("");
            const [error, setError] = useState("");
            const [loading, setLoading] = useState(false);

            const handleSubmit = () => {
                setError("");
                if (!username || !password) return setError("Please fill in all fields.");
                
                setLoading(true);
                
                // Simulate network request
                setTimeout(() => {
                    // Get entire database from LocalStorage
                    const db = JSON.parse(localStorage.getItem('samir_os_users_db') || '{}');

                    if (isLogin) {
                        // LOGIN LOGIC
                        const userRecord = db[username];
                        if (userRecord && userRecord.password === password) {
                            onAuthenticate(username, userRecord.data);
                        } else {
                            setError("Invalid Credentials.");
                            setLoading(false);
                        }
                    } else {
                        // SIGNUP LOGIC
                        if (db[username]) {
                            setError("Username already taken.");
                            setLoading(false);
                        } else {
                            // Create new user
                            const newUser = {
                                password: password,
                                data: null // Will load defaults
                            };
                            db[username] = newUser;
                            localStorage.setItem('samir_os_users_db', JSON.stringify(db));
                            onAuthenticate(username, null); // Success
                        }
                    }
                }, 1000);
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center p-6 relative z-10">
                    <div className="mb-8 text-center animate-float">
                        <div className="w-24 h-24 bg-gradient-to-br from-aether-dark to-gray-800 rounded-[2rem] mx-auto mb-6 flex items-center justify-center shadow-2xl text-white">
                            <Icon name="layers" size={40} />
                        </div>
                        <h1 className="font-display font-bold text-5xl text-aether-dark tracking-tight mb-2">Samir OS</h1>
                        <p className="text-aether-muted font-medium uppercase tracking-widest text-xs">Secure Workspace Environment</p>
                    </div>

                    <div className="aerogel-card w-full max-w-sm p-8 animate-soft-rise">
                        <div className="flex gap-4 mb-8 p-1 bg-gray-100/50 rounded-xl">
                            <button onClick={() => {setIsLogin(true); setError("");}} className={`flex-1 py-2 rounded-lg text-xs font-bold uppercase tracking-wider transition-all ${isLogin ? 'bg-white text-aether-dark shadow-sm' : 'text-gray-400 hover:text-gray-600'}`}>Log In</button>
                            <button onClick={() => {setIsLogin(false); setError("");}} className={`flex-1 py-2 rounded-lg text-xs font-bold uppercase tracking-wider transition-all ${!isLogin ? 'bg-white text-aether-dark shadow-sm' : 'text-gray-400 hover:text-gray-600'}`}>Sign Up</button>
                        </div>

                        <div className="space-y-4">
                            <div className="relative">
                                <Icon name="user" size={18} className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" />
                                <input 
                                    type="text" 
                                    placeholder="Username" 
                                    value={username}
                                    onChange={e => setUsername(e.target.value)}
                                    className="input-modern"
                                />
                            </div>
                            <div className="relative">
                                <Icon name="lock" size={18} className="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400" />
                                <input 
                                    type="password" 
                                    placeholder="Password" 
                                    value={password}
                                    onChange={e => setPassword(e.target.value)}
                                    className="input-modern"
                                    onKeyDown={e => e.key === 'Enter' && handleSubmit()}
                                />
                            </div>
                        </div>

                        {error && <div className="mt-4 text-center text-red-500 text-xs font-bold bg-red-50 py-2 rounded-lg border border-red-100">{error}</div>}

                        <button 
                            onClick={handleSubmit} 
                            disabled={loading}
                            className="btn-glass w-full py-4 mt-8 flex items-center justify-center gap-2"
                        >
                            {loading ? (
                                <Icon name="loader-2" className="animate-spin" />
                            ) : (
                                <>{isLogin ? 'Access System' : 'Create Account'} <Icon name="arrow-right" size={18} /></>
                            )}
                        </button>
                    </div>
                    <p className="mt-8 text-aether-muted text-[10px] font-bold uppercase tracking-widest opacity-50">v2.4.0 // Secure Encrypted Local Storage</p>
                </div>
            );
        };


        // --- 2. THE MAIN APPLICATION (OS) ---
        const MainOS = ({ user, initialData, onLogout }) => {
            // Default Data
            const DEFAULTS = {
                schedule: [
                    {id:'1',title:'Morning Flow',duration:1,date: new Date().toISOString().split('T')[0],startHour:8},
                    {id:'2',title:'Deep Work',duration:3,date: new Date().toISOString().split('T')[0],startHour:10}
                ],
                todos: [{id:1,text:"Welcome to your OS",done:false}],
                projects: [{id:1,title:"My First Project",category:"General",progress:0,milestones:[]}],
                xp: 0
            };

            // State
            const [schedule, setSchedule] = useState(initialData?.schedule || DEFAULTS.schedule);
            const [todos, setTodos] = useState(initialData?.todos || DEFAULTS.todos);
            const [projects, setProjects] = useState(initialData?.projects || DEFAULTS.projects);
            const [xp, setXp] = useState(initialData?.xp || 0);
            const [view, setView] = useState('home');
            const [now, setNow] = useState(new Date());

            // Tick
            useEffect(() => { const t = setInterval(() => setNow(new Date()), 60000); return () => clearInterval(t); }, []);

            // Auto-Save to Specific User DB
            useEffect(() => {
                const db = JSON.parse(localStorage.getItem('samir_os_users_db') || '{}');
                if (db[user]) {
                    db[user].data = { schedule, todos, projects, xp };
                    localStorage.setItem('samir_os_users_db', JSON.stringify(db));
                }
            }, [schedule, todos, projects, xp, user]);

            const gainXp = (am) => { 
                setXp(p => { 
                    const n = p + am; 
                    if(Math.floor(n/100) > Math.floor(p/100)) confetti({colors:['#FF4F00', '#0066CC']}); 
                    return n; 
                }) 
            };

            // --- VIEWS (Simplified for Integration) ---
            return (
                <div className="min-h-screen pb-24 relative z-10 animate-soft-rise">
                     {/* Header */}
                     <div className="px-6 py-4 flex justify-between items-center bg-white/60 backdrop-blur-md sticky top-0 z-40 border-b border-white">
                        <div className="flex items-center gap-3">
                            <div className="w-8 h-8 bg-aether-dark rounded-full flex items-center justify-center text-white text-xs font-bold">{user.charAt(0).toUpperCase()}</div>
                            <div className="leading-none">
                                <div className="text-xs font-bold text-aether-muted uppercase tracking-wider">Logged in as</div>
                                <div className="font-display font-bold text-lg text-aether-dark">{user}</div>
                            </div>
                        </div>
                        <button onClick={onLogout} className="w-8 h-8 rounded-full border border-gray-200 flex items-center justify-center text-red-500 hover:bg-red-50 transition-colors"><Icon name="log-out" size={14} /></button>
                    </div>

                    {/* Home View */}
                    {view === 'home' && (
                        <div className="p-6 space-y-6">
                            <div className="aerogel-card p-8 text-center">
                                <div className="text-6xl font-display font-bold text-aether-dark mb-2">{now.toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'})}</div>
                                <div className="text-aether-secondary font-bold uppercase text-xs tracking-widest">{now.toDateString()}</div>
                            </div>
                            <div className="grid grid-cols-2 gap-4">
                                <div className="aerogel-card p-6">
                                    <div className="text-xs font-bold text-aether-muted uppercase mb-2">Pending</div>
                                    <div className="text-3xl font-bold text-aether-dark">{todos.filter(t=>!t.done).length}</div>
                                </div>
                                <div className="aerogel-card p-6">
                                    <div className="text-xs font-bold text-aether-muted uppercase mb-2">XP Level</div>
                                    <div className="text-3xl font-bold text-aether-accent">{Math.floor(xp/100)+1}</div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Planner View */}
                    {view === 'week' && (
                        <div className="p-6">
                            <div className="flex justify-between mb-6">
                                <h2 className="text-2xl font-display font-bold">Schedule</h2>
                                <button onClick={()=>{
                                    const t=prompt("Title"); if(t) setSchedule([...schedule, {id:Date.now(), title:t, duration:1, date:new Date().toISOString().split('T')[0], startHour:12}]);
                                }} className="w-8 h-8 bg-aether-dark text-white rounded-lg flex items-center justify-center"><Icon name="plus" size={16}/></button>
                            </div>
                            <div className="space-y-3">
                                {schedule.map(s => (
                                    <div key={s.id} className="aerogel-card p-4 flex justify-between items-center">
                                        <div><div className="font-bold">{s.title}</div><div className="text-xs text-gray-500">{s.duration}h</div></div>
                                        <button onClick={()=>setSchedule(schedule.filter(x=>x.id!==s.id))} className="text-red-400"><Icon name="trash-2" size={14}/></button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Focus View */}
                    {view === 'day' && (
                        <div className="p-6">
                            <h2 className="text-2xl font-display font-bold mb-6">Tasks</h2>
                            <div className="flex gap-2 mb-6">
                                <input type="text" id="newTask" placeholder="New Task..." className="flex-1 bg-white border rounded-xl px-4 outline-none" onKeyDown={e=>{
                                    if(e.key==='Enter'&&e.target.value){setTodos([...todos,{id:Date.now(),text:e.target.value,done:false}]); e.target.value='';}
                                }}/>
                            </div>
                            <div className="space-y-2">
                                {todos.map(t=>(
                                    <div key={t.id} onClick={()=>{setTodos(todos.map(x=>x.id===t.id?{...x,done:!x.done}:x)); if(!t.done) gainXp(10);}} className={`p-4 rounded-xl border flex items-center gap-3 transition-all ${t.done?'bg-gray-100 opacity-50':'bg-white'}`}>
                                        <div className={`w-5 h-5 rounded-full border flex items-center justify-center ${t.done?'bg-aether-dark text-white':''}`}>{t.done && <Icon name="check" size={10}/>}</div>
                                        <span className={t.done?'line-through':''}>{t.text}</span>
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Projects View */}
                    {view === 'projects' && (
                         <div className="p-6">
                            <div className="flex justify-between mb-6">
                                <h2 className="text-2xl font-display font-bold">Projects</h2>
                                <button onClick={()=>{const t=prompt("Project Name"); if(t) setProjects([...projects,{id:Date.now(),title:t,category:'General',progress:0,milestones:[]}])}} className="w-8 h-8 bg-aether-dark text-white rounded-lg flex items-center justify-center"><Icon name="plus" size={16}/></button>
                            </div>
                            {projects.map(p => (
                                <div key={p.id} className="aerogel-card p-6 mb-4">
                                    <div className="flex justify-between mb-2">
                                        <span className="font-bold text-lg">{p.title}</span>
                                        <span className="text-xs font-bold text-aether-muted bg-gray-100 px-2 py-1 rounded">{p.progress}%</span>
                                    </div>
                                    <div className="h-1.5 bg-gray-100 rounded-full overflow-hidden mb-4"><div className="h-full bg-aether-leaf transition-all" style={{width:`${p.progress}%`}}></div></div>
                                    <div className="space-y-2">
                                        {p.milestones.map(m=>(<div key={m.id} className="text-sm border-b pb-1">{m.text}</div>))}
                                        <button onClick={()=>{
                                            const m=prompt("Milestone"); if(m) setProjects(projects.map(x=>x.id===p.id?{...x,milestones:[...x.milestones,{id:Date.now(),text:m,done:false}]}:x));
                                        }} className="text-xs text-aether-secondary font-bold mt-2">+ Add Milestone</button>
                                    </div>
                                    <button onClick={()=>setProjects(projects.filter(x=>x.id!==p.id))} className="text-xs text-red-400 font-bold mt-4">Delete Project</button>
                                </div>
                            ))}
                         </div>
                    )}

                    {/* Dock */}
                    <div className="fixed bottom-6 left-1/2 -translate-x-1/2 bg-white/90 backdrop-blur-xl border border-white/60 p-2 rounded-2xl shadow-2xl flex gap-2 z-50">
                        {[
                            {id:'home', i:'layout-grid'},
                            {id:'week', i:'calendar'},
                            {id:'day', i:'zap'},
                            {id:'projects', i:'layers'}
                        ].map(item => (
                            <button key={item.id} onClick={()=>setView(item.id)} className={`p-3 rounded-xl transition-all ${view===item.id ? 'bg-aether-dark text-white' : 'text-gray-400 hover:bg-gray-100'}`}>
                                <Icon name={item.i} size={20} />
                            </button>
                        ))}
                    </div>
                </div>
            );
        };

        // --- 3. ROOT ORCHESTRATOR ---
        const App = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [userData, setUserData] = useState(null);

            const handleLogin = (user, data) => {
                setCurrentUser(user);
                setUserData(data);
            };

            const handleLogout = () => {
                setCurrentUser(null);
                setUserData(null);
            };

            return (
                <>
                    {!currentUser ? (
                        <AuthPortal onAuthenticate={handleLogin} />
                    ) : (
                        <MainOS user={currentUser} initialData={userData} onLogout={handleLogout} />
                    )}
                </>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
